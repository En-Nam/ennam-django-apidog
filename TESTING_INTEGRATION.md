# Integration Testing with Test Django Project

## Overview

The `test_django_project/` folder provides a complete Django project for testing the `ennam-django-apidog` package. It's included in the repository but ignored by Git for cleanliness.

## Quick Start

### 1. Navigate to Test Project

```bash
cd test_django_project
```

### 2. Setup Virtual Environment

```bash
# Create virtual environment
python -m venv venv

# Activate (Windows)
venv\Scripts\activate

# Activate (macOS/Linux)
source venv/bin/activate
```

### 3. Install Dependencies

```bash
# Install Django ecosystem
pip install Django==4.2 djangorestframework==3.14 drf-spectacular==0.27

# Install ennam-django-apidog from parent directory
pip install -e ..
```

### 4. Run Commands

```bash
# Initialize APIDOG
python manage.py apidog init

# Export OpenAPI schema
python manage.py apidog export

# Validate schema
python manage.py apidog validate

# Generate environment configuration
python manage.py apidog env-config
```

## Test Project Features

### API Views

Three mock API endpoints for testing:

- **HealthCheckView** (`/api/health/`)
  - Simple health check endpoint
  - Returns status OK message

- **UsersListView** (`/api/users/`)
  - Mock users list with 2 sample users
  - Returns user data with id, name, email

- **ProductsListView** (`/api/products/`)
  - Mock products list with 2 sample products
  - Returns product data with id, name, price

### OpenAPI Integration

- **Schema Endpoint**: `/api/schema/`
  - Served by drf-spectacular
  - Properly hooks into APIDOG schema generation

### Django Configuration

**settings.py** includes:

```python
INSTALLED_APPS = [
    'django.contrib.contenttypes',
    'django.contrib.auth',
    'rest_framework',
    'drf_spectacular',
    'ennam_django_apidog',
]

REST_FRAMEWORK = {
    'DEFAULT_SCHEMA_CLASS': 'drf_spectacular.openapi.AutoSchema',
}

SPECTACULAR_SETTINGS = {
    'TITLE': 'Test Django API',
    'DESCRIPTION': 'A test Django REST Framework API',
    'VERSION': '1.0.0',
    'PREPROCESSING_HOOKS': [
        'ennam_django_apidog.schema_hooks.preprocess_exclude_problematic_views',
    ],
    'EXTENSIONS': [
        'ennam_django_apidog.schema_hooks.BaseSerializerExtension',
    ],
}

APIDOG_SETTINGS = {
    'PROJECT_ID': 'test-project-id',
    'TOKEN': 'test-api-token',
    'OUTPUT_DIR': os.path.join(BASE_DIR, 'apidog'),
}
```

## Generated Files

After running commands, you'll see:

```
apidog/
â”œâ”€â”€ README.md                           # APIDOG setup guide
â”œâ”€â”€ environments.json                   # Environment config
â”œâ”€â”€ openapi_schema_latest.json          # Latest schema
â”œâ”€â”€ openapi_schema_20251202_182753.json # Timestamped schema
â”œâ”€â”€ apidog_environments.json            # Generated env config
â”œâ”€â”€ Makefile.apidog                     # Make commands
â””â”€â”€ docker-compose.apidog.yml           # Docker compose
```

## File Structure

```
test_django_project/
â”œâ”€â”€ manage.py                 # Django management script
â”œâ”€â”€ README.md                 # Project overview
â”œâ”€â”€ USAGE.md                  # Usage instructions
â”œâ”€â”€ .gitignore                # Local ignore rules
â”œâ”€â”€ Makefile.apidog          # Generated Make commands
â”œâ”€â”€ docker-compose.apidog.yml # Generated Docker config
â”œâ”€â”€ environments.json         # Generated environment config
â”œâ”€â”€ project/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ settings.py          # Django configuration
â”‚   â”œâ”€â”€ urls.py              # URL routing
â”‚   â”œâ”€â”€ wsgi.py              # WSGI application
â””â”€â”€ apidog/                  # Generated by apidog commands
    â”œâ”€â”€ README.md
    â”œâ”€â”€ environments.json
    â”œâ”€â”€ openapi_schema_latest.json
    â””â”€â”€ ... (other files)
```

## Common Tasks

### Export and Validate Schema

```bash
# Export schema from Django
python manage.py apidog export

# Validate generated schema
python manage.py apidog validate
```

### Check Generated Configuration

```bash
# Generate environment configuration
python manage.py apidog env-config

# View the generated config
cat apidog/apidog_environments.json
```

### View OpenAPI Schema

```bash
# Pretty print the schema
python -m json.tool apidog/openapi_schema_latest.json
```

### Clean Up Generated Files

```bash
# Remove all generated files
rm -rf apidog/ db.sqlite3 *.log

# Remove virtual environment
rm -rf venv/

# Clear Python cache
find . -type d -name __pycache__ -exec rm -rf {} + 2>/dev/null || true
```

## Git Integration

**Important**: The `test_django_project/` directory is in `.gitignore`:

```
# Test Django Project
test_django_project/
```

This means:
- âœ… Test project files are NOT committed
- âœ… Generated files won't clutter the repository
- âœ… Everyone can maintain their own test setup
- âœ… Testing doesn't affect version control

## Troubleshooting

### ImportError: cannot import 'SpectacularSwaggerAPIView'

**Cause**: Version mismatch in drf-spectacular

**Solution**: The test project uses only `SpectacularAPIView` (the schema endpoint), which is always available.

### Django Apps Not Loaded

**Cause**: Django not initialized

**Solution**: 
```bash
python manage.py check  # Verify Django setup
python manage.py migrate  # Run migrations (if needed)
```

### Schema Export Warnings

The test project uses simple APIView classes without serializers. You may see warnings like:

```
Error [HealthCheckView]: unable to guess serializer
```

This is normal and doesn't affect schema generation. For proper serializer schemas, use DRF serializers.

## Next Steps

After testing the commands, you can:

1. **Modify Test Views**: Edit `project/urls.py` to add more test endpoints
2. **Test with Real Serializers**: Create DRF serializers for testing
3. **Test APIDOG Integration**: Add real APIDOG credentials to test push/pull
4. **Performance Testing**: Test with large schemas or many endpoints

## Support

For issues with:

- **ennam-django-apidog package**: See package documentation
- **Test project setup**: Check USAGE.md in test_django_project/
- **Django/DRF questions**: See Django and DRF documentation
- **drf-spectacular**: See drf-spectacular docs

---

Happy testing! ðŸš€
